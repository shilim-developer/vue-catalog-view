(function(b,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(b=typeof globalThis<"u"?globalThis:b||self,e(b["vue-catalog"]={},b.Vue))})(this,function(b,e){"use strict";function z(t){return e.getCurrentScope()?(e.onScopeDispose(t),!0):!1}function T(t){return typeof t=="function"?t():e.unref(t)}const q=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const G=Object.prototype.toString,X=t=>G.call(t)==="[object Object]",S=()=>{};function R(t,l){function o(...n){return new Promise((a,u)=>{Promise.resolve(t(()=>l.apply(this,n),{fn:l,thisArg:this,args:n})).then(a).catch(u)})}return o}function Y(t,l={}){let o,n,a=S;const u=m=>{clearTimeout(m),a(),a=S};return m=>{const r=T(t),c=T(l.maxWait);return o&&u(o),r<=0||c!==void 0&&c<=0?(n&&(u(n),n=null),Promise.resolve(m())):new Promise((h,i)=>{a=l.rejectOnCancel?i:h,c&&!n&&(n=setTimeout(()=>{o&&u(o),n=null,h(m())},c)),o=setTimeout(()=>{n&&u(n),n=null,h(m())},r)})}}function J(...t){let l=0,o,n=!0,a=S,u,d,m,r,c;!e.isRef(t[0])&&typeof t[0]=="object"?{delay:d,trailing:m=!0,leading:r=!0,rejectOnCancel:c=!1}=t[0]:[d,m=!0,r=!0,c=!1]=t;const h=()=>{o&&(clearTimeout(o),o=void 0,a(),a=S)};return s=>{const g=T(d),v=Date.now()-l,p=()=>u=s();return h(),g<=0?(l=Date.now(),p()):(v>g&&(r||!n)?(l=Date.now(),p()):m&&(u=new Promise((y,_)=>{a=c?_:y,o=setTimeout(()=>{l=Date.now(),n=!0,y(p()),h()},Math.max(0,g-v))})),!r&&!o&&(o=setTimeout(()=>n=!0,g)),n=!1,u)}}function K(t){return e.getCurrentInstance()}function Q(t,l=200,o={}){return R(Y(l,o),t)}function U(t,l=200,o=!1,n=!0,a=!1){return R(J(l,o,n,a),t)}function Z(t,l=!0,o){K()?e.onMounted(t,o):l?t():e.nextTick(t)}function W(t){var l;const o=T(t);return(l=o==null?void 0:o.$el)!=null?l:o}const V=q?window:void 0;function I(...t){let l,o,n,a;if(typeof t[0]=="string"||Array.isArray(t[0])?([o,n,a]=t,l=V):[l,o,n,a]=t,!l)return S;Array.isArray(o)||(o=[o]),Array.isArray(n)||(n=[n]);const u=[],d=()=>{u.forEach(h=>h()),u.length=0},m=(h,i,s,g)=>(h.addEventListener(i,s,g),()=>h.removeEventListener(i,s,g)),r=e.watch(()=>[W(l),T(a)],([h,i])=>{if(d(),!h)return;const s=X(i)?{...i}:i;u.push(...o.flatMap(g=>n.map(v=>m(h,g,v,s))))},{immediate:!0,flush:"post"}),c=()=>{r(),d()};return z(c),c}const M=1;function ee(t,l={}){const{throttle:o=0,idle:n=200,onStop:a=S,onScroll:u=S,offset:d={left:0,right:0,top:0,bottom:0},eventListenerOptions:m={capture:!1,passive:!0},behavior:r="auto",window:c=V,onError:h=f=>{console.error(f)}}=l,i=e.ref(0),s=e.ref(0),g=e.computed({get(){return i.value},set(f){p(f,void 0)}}),v=e.computed({get(){return s.value},set(f){p(void 0,f)}});function p(f,$){var C,L,D,w;if(!c)return;const E=T(t);if(!E)return;(D=E instanceof Document?c.document.body:E)==null||D.scrollTo({top:(C=T($))!=null?C:v.value,left:(L=T(f))!=null?L:g.value,behavior:T(r)});const P=((w=E==null?void 0:E.document)==null?void 0:w.documentElement)||(E==null?void 0:E.documentElement)||E;g!=null&&(i.value=P.scrollLeft),v!=null&&(s.value=P.scrollTop)}const y=e.ref(!1),_=e.reactive({left:!0,right:!1,top:!0,bottom:!1}),k=e.reactive({left:!1,right:!1,top:!1,bottom:!1}),B=f=>{y.value&&(y.value=!1,k.left=!1,k.right=!1,k.top=!1,k.bottom=!1,a(f))},ke=Q(B,o+n),N=f=>{var $;if(!c)return;const C=(($=f==null?void 0:f.document)==null?void 0:$.documentElement)||(f==null?void 0:f.documentElement)||W(f),{display:L,flexDirection:D}=getComputedStyle(C),w=C.scrollLeft;k.left=w<i.value,k.right=w>i.value;const E=Math.abs(w)<=(d.left||0),P=Math.abs(w)+C.clientWidth>=C.scrollWidth-(d.right||0)-M;L==="flex"&&D==="row-reverse"?(_.left=P,_.right=E):(_.left=E,_.right=P),i.value=w;let A=C.scrollTop;f===c.document&&!A&&(A=c.document.body.scrollTop),k.top=A<s.value,k.bottom=A>s.value;const F=Math.abs(A)<=(d.top||0),H=Math.abs(A)+C.clientHeight>=C.scrollHeight-(d.bottom||0)-M;L==="flex"&&D==="column-reverse"?(_.top=H,_.bottom=F):(_.top=F,_.bottom=H),s.value=A},x=f=>{var $;if(!c)return;const C=($=f.target.documentElement)!=null?$:f.target;N(C),y.value=!0,ke(f),u(f)};return I(t,"scroll",o?U(x,o,!0,!1):x,m),Z(()=>{try{const f=T(t);if(!f)return;N(f)}catch(f){h(f)}}),I(t,"scrollend",B,m),{x:g,y:v,isScrolling:y,arrivedState:_,directions:k,measure(){const f=T(t);c&&f&&N(f)}}}const te=(t,l)=>new Promise(o=>{const n=()=>{t.removeEventListener("scrollend",n),o(!0)};t.addEventListener("scrollend",n),t.scrollTo(l)}),oe=t=>new Promise(l=>setTimeout(l,t)),O=t=>{const l=e.ref([]),o=e.ref(0),n=e.ref(!1),a=e.ref(),{y:u}=ee(t.scrollContainer,{throttle:100}),d=e.ref(document.createElement("div")),m=async()=>{await e.nextTick();const i=t.selector.reduce((p,y,_)=>(p[y]=_,p),{}),s=d.value.querySelectorAll(t.selector.join(",")),g=Array.from(s).filter(p=>p instanceof HTMLElement&&p.innerText.trim());if(!g.length)return[];const v=p=>{const y=p.tagName.toLowerCase(),_=p.classList;let k=0;for(const B of _)if(Object.prototype.hasOwnProperty.call(i,`.${B}`)){k=i[`.${B}`]||0;break}return Object.prototype.hasOwnProperty.call(i,y)&&(k=i[y]||0),k};return g.map((p,y)=>(p.id||(p.id=`vcvTitle${y}`),{title:p.innerText,id:p.id,catalogId:`vcvAnchor${y}`,level:v(p),offsetTop:p.offsetTop}))},r=i=>{if(!n.value)for(let s=0;s<l.value.length;s++){const v=l.value[s].offsetTop-i-t.topDistance;if(console.log("top:",v,s),v>0&&s-1>=0){o.value=s-1,c();break}o.value=s}},c=()=>{var y,_,k;const i=document.querySelector(`#vcvAnchor${o.value}`),s=((y=a.value)==null?void 0:y.clientHeight)||0,g=i.offsetTop,v=((_=a.value)==null?void 0:_.scrollTop)||0,p=g-v;(p>s/2||p<s/2)&&((k=a.value)==null||k.scrollTo({top:g-s/2,behavior:n.value?"instant":"smooth"}))},h=async(i,s)=>{if(n.value=!0,o.value=s,c(),t.useAnchor){n.value=!1;return}await te(t.scrollContainer,{top:i.offsetTop-t.topDistance,behavior:"smooth"}),await oe(100),n.value=!1};return e.watch(()=>u.value,()=>{console.log(u.value),r(u.value)}),e.watch(()=>[t.contentContainer,t.isWatch],async i=>{console.log("val:",i);const[s,g]=i;s&&(s.$el?d.value=s.$el:d.value=s,l.value=await m())},{immediate:!0}),{titles:l,currentIndex:o,catalogRef:a,handleAnchorClick:h}},ne={class:"vcv-wrapper"},le=["id","onClick"],re=["href"],ce={key:1},se=e.defineComponent({__name:"LineCatalog",props:{contentContainer:{default:()=>document.body},scrollContainer:{default:()=>window},selector:{},isWatch:{type:Boolean,default:!1},topDistance:{default:0},useAnchor:{type:Boolean,default:!0}},setup(t){const l=t,{titles:o,currentIndex:n,catalogRef:a,handleAnchorClick:u}=O(l);return(d,m)=>(e.openBlock(),e.createElementBlock("div",ne,[m[0]||(m[0]=e.createElementVNode("div",{class:"vcv-line"},null,-1)),e.createElementVNode("div",{class:"vcv-catalog-content",ref_key:"catalogRef",ref:a},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(r,c)=>e.renderSlot(d.$slots,"default",e.mergeProps({key:r.title,ref_for:!0},{active:e.unref(n)===c,anchor:r}),()=>[e.createElementVNode("div",{id:`vcvAnchor${c}`,class:e.normalizeClass(["vcv-line-catalog-item",e.unref(n)===c?"active":""]),style:e.normalizeStyle({paddingLeft:`${10+r.level*15}px`}),onClick:h=>e.unref(u)(r,c)},[d.useAnchor?(e.openBlock(),e.createElementBlock("a",{key:0,href:`#${r.id}`},e.toDisplayString(r.title),9,re)):(e.openBlock(),e.createElementBlock("span",ce,e.toDisplayString(r.title),1))],14,le)],!0)),128))],512)]))}}),j=(t,l)=>{const o=t.__vccOpts||t;for(const[n,a]of l)o[n]=a;return o},ae=j(se,[["__scopeId","data-v-d79c3289"]]),ie={class:"vcv-wrapper"},fe=["id","onClick"],ue=["href"],de={key:1},pe=j(e.defineComponent({__name:"PointCatalog",props:{contentContainer:{},scrollContainer:{default:()=>window},selector:{},isWatch:{type:Boolean,default:!1},topDistance:{default:0},useAnchor:{type:Boolean,default:!0}},setup(t){const l=t,{titles:o,currentIndex:n,catalogRef:a,handleAnchorClick:u}=O(l);return(d,m)=>(e.openBlock(),e.createElementBlock("div",ie,[m[0]||(m[0]=e.createElementVNode("div",{class:"vcv-line"},null,-1)),e.createElementVNode("div",{class:"vcv-catalog-content",ref_key:"catalogRef",ref:a},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(r,c)=>e.renderSlot(d.$slots,"default",e.mergeProps({key:r.title,ref_for:!0},{active:e.unref(n)===c,anchor:r}),()=>[e.createElementVNode("div",{id:`vcvAnchor${c}`,class:e.normalizeClass(["vcv-point-catalog-item",e.unref(n)===c?"active":""]),style:e.normalizeStyle({paddingLeft:`${10+r.level*15}px`}),onClick:h=>e.unref(u)(r,c)},[d.useAnchor?(e.openBlock(),e.createElementBlock("a",{key:0,href:`#${r.id}`},e.toDisplayString(r.title),9,ue)):(e.openBlock(),e.createElementBlock("span",de,e.toDisplayString(r.title),1))],14,fe)],!0)),128))],512)]))}}),[["__scopeId","data-v-f000910c"]]),me={class:"vcv-wrapper"},he=["id","onClick"],ge=["href"],ye={key:1},_e=j(e.defineComponent({__name:"NormalCatalog",props:{contentContainer:{default:()=>document.body},scrollContainer:{default:()=>window},selector:{},isWatch:{type:Boolean,default:!1},topDistance:{default:0},useAnchor:{type:Boolean,default:!0}},setup(t){const l=t,{titles:o,currentIndex:n,catalogRef:a,handleAnchorClick:u}=O(l);return(d,m)=>(e.openBlock(),e.createElementBlock("div",me,[e.createElementVNode("div",{class:"vcv-catalog-content",ref_key:"catalogRef",ref:a},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),(r,c)=>e.renderSlot(d.$slots,"default",e.mergeProps({key:r.title,ref_for:!0},{active:e.unref(n)===c,anchor:r}),()=>[e.createElementVNode("div",{id:`vcvAnchor${c}`,class:e.normalizeClass(["vcv-line-catalog-item",e.unref(n)===c?"active":""]),style:e.normalizeStyle({paddingLeft:`${10+r.level*15}px`}),onClick:h=>e.unref(u)(r,c)},[d.useAnchor?(e.openBlock(),e.createElementBlock("a",{key:0,href:`#${r.id}`},e.toDisplayString(r.title),9,ge)):(e.openBlock(),e.createElementBlock("span",ye,e.toDisplayString(r.title),1))],14,he)],!0)),128))],512)]))}}),[["__scopeId","data-v-9efa29d3"]]);b.LineCatalog=ae,b.NormalCatalog=_e,b.PointCatalog=pe,Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});
