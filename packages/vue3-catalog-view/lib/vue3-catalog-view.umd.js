(function(A,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(A=typeof globalThis<"u"?globalThis:A||self,t(A["vue3-catalog-view"]={},A.Vue))})(this,function(A,t){"use strict";require("./style.css");function B(e){return t.getCurrentScope()?(t.onScopeDispose(e),!0):!1}function T(e){return typeof e=="function"?e():t.unref(e)}const G=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Q=e=>e!=null,X=Object.prototype.toString,J=e=>X.call(e)==="[object Object]",I=()=>{};function V(e,n){function o(...r){return new Promise((l,i)=>{Promise.resolve(e(()=>n.apply(this,r),{fn:n,thisArg:this,args:r})).then(l).catch(i)})}return o}function K(e,n={}){let o,r,l=I;const i=c=>{clearTimeout(c),l(),l=I};return c=>{const d=T(e),a=T(n.maxWait);return o&&i(o),d<=0||a!==void 0&&a<=0?(r&&(i(r),r=null),Promise.resolve(c())):new Promise((u,m)=>{l=n.rejectOnCancel?m:u,a&&!r&&(r=setTimeout(()=>{o&&i(o),r=null,u(c())},a)),o=setTimeout(()=>{r&&i(r),r=null,u(c())},d)})}}function U(...e){let n=0,o,r=!0,l=I,i,f,c,d,a;!t.isRef(e[0])&&typeof e[0]=="object"?{delay:f,trailing:c=!0,leading:d=!0,rejectOnCancel:a=!1}=e[0]:[f,c=!0,d=!0,a=!1]=e;const u=()=>{o&&(clearTimeout(o),o=void 0,l(),l=I)};return v=>{const g=T(f),C=Date.now()-n,O=()=>i=v();return u(),g<=0?(n=Date.now(),O()):(C>g&&(d||!r)?(n=Date.now(),O()):c&&(i=new Promise((E,h)=>{l=a?h:E,o=setTimeout(()=>{n=Date.now(),r=!0,E(O()),u()},Math.max(0,g-C))})),!d&&!o&&(o=setTimeout(()=>r=!0,g)),r=!1,i)}}function Z(e){return t.getCurrentInstance()}function ee(e,n=200,o={}){return V(K(n,o),e)}function te(e,n=200,o=!1,r=!0,l=!1){return V(U(n,o,r,l),e)}function H(e,n=!0,o){Z()?t.onMounted(e,o):n?e():t.nextTick(e)}const W=G?window:void 0;function N(e){var n;const o=T(e);return(n=o==null?void 0:o.$el)!=null?n:o}function x(...e){let n,o,r,l;if(typeof e[0]=="string"||Array.isArray(e[0])?([o,r,l]=e,n=W):[n,o,r,l]=e,!n)return I;Array.isArray(o)||(o=[o]),Array.isArray(r)||(r=[r]);const i=[],f=()=>{i.forEach(u=>u()),i.length=0},c=(u,m,v,g)=>(u.addEventListener(m,v,g),()=>u.removeEventListener(m,v,g)),d=t.watch(()=>[N(n),T(l)],([u,m])=>{if(f(),!u)return;const v=J(m)?{...m}:m;i.push(...o.flatMap(g=>r.map(C=>c(u,g,C,v))))},{immediate:!0,flush:"post"}),a=()=>{d(),f()};return B(a),a}function ne(){const e=t.ref(!1),n=t.getCurrentInstance();return n&&t.onMounted(()=>{e.value=!0},n),e}function R(e){const n=ne();return t.computed(()=>(n.value,!!e()))}function oe(e,n,o={}){const{window:r=W,...l}=o;let i;const f=R(()=>r&&"MutationObserver"in r),c=()=>{i&&(i.disconnect(),i=void 0)},d=t.computed(()=>{const v=T(e),g=(Array.isArray(v)?v:[v]).map(N).filter(Q);return new Set(g)}),a=t.watch(()=>d.value,v=>{c(),f.value&&v.size&&(i=new MutationObserver(n),v.forEach(g=>i.observe(g,l)))},{immediate:!0,flush:"post"}),u=()=>i==null?void 0:i.takeRecords(),m=()=>{a(),c()};return B(m),{isSupported:f,stop:m,takeRecords:u}}function re(e,n={}){const{window:o=W}=n,r=R(()=>o&&"matchMedia"in o&&typeof o.matchMedia=="function");let l;const i=t.ref(!1),f=a=>{i.value=a.matches},c=()=>{l&&("removeEventListener"in l?l.removeEventListener("change",f):l.removeListener(f))},d=t.watchEffect(()=>{r.value&&(c(),l=o.matchMedia(T(e)),"addEventListener"in l?l.addEventListener("change",f):l.addListener(f),i.value=l.matches)});return B(()=>{d(),c(),l=void 0}),i}const F=1;function le(e,n={}){const{throttle:o=0,idle:r=200,onStop:l=I,onScroll:i=I,offset:f={left:0,right:0,top:0,bottom:0},eventListenerOptions:c={capture:!1,passive:!0},behavior:d="auto",window:a=W,onError:u=s=>{console.error(s)}}=n,m=t.ref(0),v=t.ref(0),g=t.computed({get(){return m.value},set(s){O(s,void 0)}}),C=t.computed({get(){return v.value},set(s){O(void 0,s)}});function O(s,b){var w,P,$,M;if(!a)return;const k=T(e);if(!k)return;($=k instanceof Document?a.document.body:k)==null||$.scrollTo({top:(w=T(b))!=null?w:C.value,left:(P=T(s))!=null?P:g.value,behavior:T(d)});const j=((M=k==null?void 0:k.document)==null?void 0:M.documentElement)||(k==null?void 0:k.documentElement)||k;g!=null&&(m.value=j.scrollLeft),C!=null&&(v.value=j.scrollTop)}const E=t.ref(!1),h=t.reactive({left:!0,right:!1,top:!0,bottom:!1}),p=t.reactive({left:!1,right:!1,top:!1,bottom:!1}),_=s=>{E.value&&(E.value=!1,p.left=!1,p.right=!1,p.top=!1,p.bottom=!1,l(s))},L=ee(_,o+r),y=s=>{var b;if(!a)return;const w=((b=s==null?void 0:s.document)==null?void 0:b.documentElement)||(s==null?void 0:s.documentElement)||N(s),{display:P,flexDirection:$}=getComputedStyle(w),M=w.scrollLeft;p.left=M<m.value,p.right=M>m.value;const k=Math.abs(M)<=(f.left||0),j=Math.abs(M)+w.clientWidth>=w.scrollWidth-(f.right||0)-F;P==="flex"&&$==="row-reverse"?(h.left=j,h.right=k):(h.left=k,h.right=j),m.value=M;let D=w.scrollTop;s===a.document&&!D&&(D=a.document.body.scrollTop),p.top=D<v.value,p.bottom=D>v.value;const q=Math.abs(D)<=(f.top||0),Y=Math.abs(D)+w.clientHeight>=w.scrollHeight-(f.bottom||0)-F;P==="flex"&&$==="column-reverse"?(h.top=Y,h.bottom=q):(h.top=q,h.bottom=Y),v.value=D},S=s=>{var b;if(!a)return;const w=(b=s.target.documentElement)!=null?b:s.target;y(w),E.value=!0,L(s),i(s)};return x(e,"scroll",o?te(S,o,!0,!1):S,c),H(()=>{try{const s=T(e);if(!s)return;y(s)}catch(s){u(s)}}),x(e,"scrollend",_,c),{x:g,y:C,isScrolling:E,arrivedState:h,directions:p,measure(){const s=T(e);a&&s&&y(s)}}}function ie(e={}){const{window:n=W,initialWidth:o=Number.POSITIVE_INFINITY,initialHeight:r=Number.POSITIVE_INFINITY,listenOrientation:l=!0,includeScrollbar:i=!0,type:f="inner"}=e,c=t.ref(o),d=t.ref(r),a=()=>{n&&(f==="outer"?(c.value=n.outerWidth,d.value=n.outerHeight):i?(c.value=n.innerWidth,d.value=n.innerHeight):(c.value=n.document.documentElement.clientWidth,d.value=n.document.documentElement.clientHeight))};if(a(),H(a),x("resize",a,{passive:!0}),l){const u=re("(orientation: portrait)");t.watch(u,()=>a())}return{width:c,height:d}}const se=(e,n)=>new Promise(o=>{const r=()=>{e.removeEventListener("scrollend",r),o(!0)};e.addEventListener("scrollend",r),e.scrollTo(n)}),ce=e=>new Promise(n=>setTimeout(n,e)),ae=(e,n="")=>{const o=n&&`-${n}-`,r=t.ref([]),l=t.ref(0),i=t.ref(!1),f=t.ref(),c=t.computed(()=>e.scrollContainer.$el?e.scrollContainer.$el:e.scrollContainer),{y:d,arrivedState:a}=le(c,{throttle:100}),{width:u}=ie(),m=t.ref(document.createElement("div")),v=async()=>{await t.nextTick(),c.value.style&&(c.value.style.position="relative");const h=e.selector.reduce((y,S,s)=>(y[S]=s,y),{}),p=m.value.querySelectorAll(e.selector.join(",")),_=Array.from(p).filter(y=>y instanceof HTMLElement&&y.innerText.trim());if(!_.length)return[];const L=y=>{const S=y.tagName.toLowerCase(),s=Array.from(y.classList);let b=0;for(const w of s)if(Object.prototype.hasOwnProperty.call(h,`.${w}`)){b=h[`.${w}`]||0;break}return Object.prototype.hasOwnProperty.call(h,S)&&(b=h[S]||0),b};return _.map((y,S)=>(y.id||(y.id=`vcvTitle${o}${S}`),{title:y.innerText,id:y.id,catalogId:`vcvAnchor${o}${S}`,level:L(y),offsetTop:y.offsetTop}))},g=h=>{if(!i.value)for(let p=0;p<r.value.length;p++){const L=r.value[p].offsetTop-h-e.topDistance;if(a.bottom){l.value=r.value.length-1,C();break}else if(L>0&&p-1>=0){l.value=p-1,C();break}l.value=p}},C=()=>{var S,s,b;const h=document.querySelector(`#vcvAnchor${o}${l.value}`),p=((S=f.value)==null?void 0:S.clientHeight)||0,_=h.offsetTop,L=((s=f.value)==null?void 0:s.scrollTop)||0,y=_-L;(y>p/2||y<p/2)&&((b=f.value)==null||b.scrollTo({top:_-p/2,behavior:i.value?"instant":"smooth"}))},O=async(h,p)=>{if(i.value=!0,l.value=p,C(),e.useAnchor){i.value=!1;return}await se(c.value,{top:h.offsetTop-e.topDistance,behavior:"smooth"}),await ce(100),i.value=!1};t.watch(()=>d.value,()=>{g(d.value)});let E;return t.watch(()=>[e.contentContainer,e.isWatch,u.value],async h=>{const[p,_]=h;if(p){if(p.$el?m.value=p.$el:m.value=p,_){E&&E();const{stop:L}=oe(m,async()=>{r.value=await v()},{childList:!0,subtree:!0,characterData:!0});E=L}else E&&E();r.value=await v()}},{immediate:!0}),{titles:r,currentIndex:l,catalogRef:f,handleAnchorClick:O}};function z(){return{type:{type:String,default:"default"},contentContainer:{type:Object,default:()=>document.body},scrollContainer:{type:Object,default:()=>window},selector:{type:Array,default:()=>["h1","h2","h3","h4","h5","h6"]},topDistance:{type:Number,default:0},indent:{type:Number,default:15},useAnchor:{type:Boolean,default:!1},isWatch:{type:Boolean,default:!0},ellipsis:{type:Boolean,default:!0}}}const ue={key:0,class:"vcv-line"},fe=["id","onClick"],de=["href"],pe={key:1},me=t.defineComponent({__name:"CatalogView",props:z(),setup(e){var f,c;const n=e,{titles:o,currentIndex:r,catalogRef:l,handleAnchorClick:i}=ae(n,((c=(f=t.getCurrentInstance())==null?void 0:f.vnode)==null?void 0:c.key)||"");return(d,a)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["vcv-wrapper",d.type])},[d.type!=="default"?(t.openBlock(),t.createElementBlock("div",ue)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"vcv-catalog-content",ref_key:"catalogRef",ref:l},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(o),(u,m)=>(t.openBlock(),t.createElementBlock("div",{key:u.title,id:u.catalogId,onClick:v=>t.unref(i)(u,m),class:t.normalizeClass(["vcv-catalog-item-wrapper",t.unref(r)===m?"active":""])},[t.renderSlot(d.$slots,"default",t.mergeProps({ref_for:!0},{active:t.unref(r)===m,anchor:u}),()=>[t.createElementVNode("div",{class:t.normalizeClass(["vcv-catalog-item",{"text-ellipsis":d.ellipsis}]),style:t.normalizeStyle({paddingLeft:`${15+(u.level-1)*d.indent}px`,paddingRight:"15px"})},[d.useAnchor?(t.openBlock(),t.createElementBlock("a",{key:0,href:`#${u.id}`},t.toDisplayString(u.title),9,de)):(t.openBlock(),t.createElementBlock("span",pe,t.toDisplayString(u.title),1))],6)],!0)],10,fe))),128))],512)],2))}}),he=((e,n)=>{const o=e.__vccOpts||e;for(const[r,l]of n)o[r]=l;return o})(me,[["__scopeId","data-v-74ebfd8f"]]);A.CatalogView=he,A.catalogViewProps=z,Object.defineProperty(A,Symbol.toStringTag,{value:"Module"})});
