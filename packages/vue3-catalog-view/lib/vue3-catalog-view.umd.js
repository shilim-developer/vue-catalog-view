(function(L,t){typeof exports=="object"&&typeof module<"u"?t(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],t):(L=typeof globalThis<"u"?globalThis:L||self,t(L["vue3-catalog-view"]={},L.Vue))})(this,function(L,t){"use strict";function B(e){return t.getCurrentScope()?(t.onScopeDispose(e),!0):!1}function E(e){return typeof e=="function"?e():t.unref(e)}const G=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Q=e=>e!=null,X=Object.prototype.toString,J=e=>X.call(e)==="[object Object]",M=()=>{};function x(e,o){function n(...r){return new Promise((l,i)=>{Promise.resolve(e(()=>o.apply(this,r),{fn:o,thisArg:this,args:r})).then(l).catch(i)})}return n}function K(e,o={}){let n,r,l=M;const i=a=>{clearTimeout(a),l(),l=M};return a=>{const m=E(e),s=E(o.maxWait);return n&&i(n),m<=0||s!==void 0&&s<=0?(r&&(i(r),r=null),Promise.resolve(a())):new Promise((h,f)=>{l=o.rejectOnCancel?f:h,s&&!r&&(r=setTimeout(()=>{n&&i(n),r=null,h(a())},s)),n=setTimeout(()=>{r&&i(r),r=null,h(a())},m)})}}function U(...e){let o=0,n,r=!0,l=M,i,u,a,m,s;!t.isRef(e[0])&&typeof e[0]=="object"?{delay:u,trailing:a=!0,leading:m=!0,rejectOnCancel:s=!1}=e[0]:[u,a=!0,m=!0,s=!1]=e;const h=()=>{n&&(clearTimeout(n),n=void 0,l(),l=M)};return p=>{const y=E(u),T=Date.now()-o,g=()=>i=p();return h(),y<=0?(o=Date.now(),g()):(T>y&&(m||!r)?(o=Date.now(),g()):a&&(i=new Promise((d,w)=>{l=s?w:d,n=setTimeout(()=>{o=Date.now(),r=!0,d(g()),h()},Math.max(0,y-T))})),!m&&!n&&(n=setTimeout(()=>r=!0,y)),r=!1,i)}}function Z(e){return t.getCurrentInstance()}function ee(e,o=200,n={}){return x(K(o,n),e)}function te(e,o=200,n=!1,r=!0,l=!1){return x(U(o,n,r,l),e)}function H(e,o=!0,n){Z()?t.onMounted(e,n):o?e():t.nextTick(e)}const W=G?window:void 0;function N(e){var o;const n=E(e);return(o=n==null?void 0:n.$el)!=null?o:n}function V(...e){let o,n,r,l;if(typeof e[0]=="string"||Array.isArray(e[0])?([n,r,l]=e,o=W):[o,n,r,l]=e,!o)return M;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const i=[],u=()=>{i.forEach(h=>h()),i.length=0},a=(h,f,p,y)=>(h.addEventListener(f,p,y),()=>h.removeEventListener(f,p,y)),m=t.watch(()=>[N(o),E(l)],([h,f])=>{if(u(),!h)return;const p=J(f)?{...f}:f;i.push(...n.flatMap(y=>r.map(T=>a(h,y,T,p))))},{immediate:!0,flush:"post"}),s=()=>{m(),u()};return B(s),s}function ne(){const e=t.ref(!1),o=t.getCurrentInstance();return o&&t.onMounted(()=>{e.value=!0},o),e}function R(e){const o=ne();return t.computed(()=>(o.value,!!e()))}function oe(e,o,n={}){const{window:r=W,...l}=n;let i;const u=R(()=>r&&"MutationObserver"in r),a=()=>{i&&(i.disconnect(),i=void 0)},m=t.computed(()=>{const p=E(e),y=(Array.isArray(p)?p:[p]).map(N).filter(Q);return new Set(y)}),s=t.watch(()=>m.value,p=>{a(),u.value&&p.size&&(i=new MutationObserver(o),p.forEach(y=>i.observe(y,l)))},{immediate:!0,flush:"post"}),h=()=>i==null?void 0:i.takeRecords(),f=()=>{s(),a()};return B(f),{isSupported:u,stop:f,takeRecords:h}}function re(e,o={}){const{window:n=W}=o,r=R(()=>n&&"matchMedia"in n&&typeof n.matchMedia=="function");let l;const i=t.ref(!1),u=s=>{i.value=s.matches},a=()=>{l&&("removeEventListener"in l?l.removeEventListener("change",u):l.removeListener(u))},m=t.watchEffect(()=>{r.value&&(a(),l=n.matchMedia(E(e)),"addEventListener"in l?l.addEventListener("change",u):l.addListener(u),i.value=l.matches)});return B(()=>{m(),a(),l=void 0}),i}const F=1;function le(e,o={}){const{throttle:n=0,idle:r=200,onStop:l=M,onScroll:i=M,offset:u={left:0,right:0,top:0,bottom:0},eventListenerOptions:a={capture:!1,passive:!0},behavior:m="auto",window:s=W,onError:h=c=>{console.error(c)}}=o,f=t.ref(0),p=t.ref(0),y=t.computed({get(){return f.value},set(c){g(c,void 0)}}),T=t.computed({get(){return p.value},set(c){g(void 0,c)}});function g(c,D){var C,P,$,O;if(!s)return;const _=E(e);if(!_)return;($=_ instanceof Document?s.document.body:_)==null||$.scrollTo({top:(C=E(D))!=null?C:T.value,left:(P=E(c))!=null?P:y.value,behavior:E(m)});const j=((O=_==null?void 0:_.document)==null?void 0:O.documentElement)||(_==null?void 0:_.documentElement)||_;y!=null&&(f.value=j.scrollLeft),T!=null&&(p.value=j.scrollTop)}const d=t.ref(!1),w=t.reactive({left:!0,right:!1,top:!0,bottom:!1}),b=t.reactive({left:!1,right:!1,top:!1,bottom:!1}),v=c=>{d.value&&(d.value=!1,b.left=!1,b.right=!1,b.top=!1,b.bottom=!1,l(c))},S=ee(v,n+r),k=c=>{var D;if(!s)return;const C=((D=c==null?void 0:c.document)==null?void 0:D.documentElement)||(c==null?void 0:c.documentElement)||N(c),{display:P,flexDirection:$}=getComputedStyle(C),O=C.scrollLeft;b.left=O<f.value,b.right=O>f.value;const _=Math.abs(O)<=(u.left||0),j=Math.abs(O)+C.clientWidth>=C.scrollWidth-(u.right||0)-F;P==="flex"&&$==="row-reverse"?(w.left=j,w.right=_):(w.left=_,w.right=j),f.value=O;let I=C.scrollTop;c===s.document&&!I&&(I=s.document.body.scrollTop),b.top=I<p.value,b.bottom=I>p.value;const q=Math.abs(I)<=(u.top||0),Y=Math.abs(I)+C.clientHeight>=C.scrollHeight-(u.bottom||0)-F;P==="flex"&&$==="column-reverse"?(w.top=Y,w.bottom=q):(w.top=q,w.bottom=Y),p.value=I},A=c=>{var D;if(!s)return;const C=(D=c.target.documentElement)!=null?D:c.target;k(C),d.value=!0,S(c),i(c)};return V(e,"scroll",n?te(A,n,!0,!1):A,a),H(()=>{try{const c=E(e);if(!c)return;k(c)}catch(c){h(c)}}),V(e,"scrollend",v,a),{x:y,y:T,isScrolling:d,arrivedState:w,directions:b,measure(){const c=E(e);s&&c&&k(c)}}}function se(e={}){const{window:o=W,initialWidth:n=Number.POSITIVE_INFINITY,initialHeight:r=Number.POSITIVE_INFINITY,listenOrientation:l=!0,includeScrollbar:i=!0,type:u="inner"}=e,a=t.ref(n),m=t.ref(r),s=()=>{o&&(u==="outer"?(a.value=o.outerWidth,m.value=o.outerHeight):i?(a.value=o.innerWidth,m.value=o.innerHeight):(a.value=o.document.documentElement.clientWidth,m.value=o.document.documentElement.clientHeight))};if(s(),H(s),V("resize",s,{passive:!0}),l){const h=re("(orientation: portrait)");t.watch(h,()=>s())}return{width:a,height:m}}const ie=(e,o)=>new Promise(n=>{const r=()=>{e.removeEventListener("scrollend",r),n(!0)};e.addEventListener("scrollend",r),e.scrollTo(o)}),ce=e=>new Promise(o=>setTimeout(o,e)),ae=(e,o)=>{const n=t.ref([]),r=t.ref(0),l=t.ref(!1),i=t.ref(),u=t.computed(()=>e.scrollContainer.$el?e.scrollContainer.$el:e.scrollContainer),{y:a}=le(u,{throttle:100}),{width:m}=se(),s=t.ref(document.createElement("div")),h=async()=>{await t.nextTick(),u.value.style&&(u.value.style.position="relative");const g=e.selector.reduce((v,S,k)=>(v[S]=k,v),{}),d=s.value.querySelectorAll(e.selector.join(",")),w=Array.from(d).filter(v=>v instanceof HTMLElement&&v.innerText.trim());if(!w.length)return[];const b=v=>{const S=v.tagName.toLowerCase(),k=Array.from(v.classList);let A=0;for(const c of k)if(Object.prototype.hasOwnProperty.call(g,`.${c}`)){A=g[`.${c}`]||0;break}return Object.prototype.hasOwnProperty.call(g,S)&&(A=g[S]||0),A};return w.map((v,S)=>(v.id||(v.id=`vcvTitle${o}-${S}`),{title:v.innerText,id:v.id,catalogId:`vcvAnchor${o}-${S}`,level:b(v),offsetTop:v.offsetTop}))},f=g=>{if(!l.value)for(let d=0;d<n.value.length;d++){const b=n.value[d].offsetTop-g-e.topDistance;if(console.log("top:",b,d),b>0&&d-1>=0){r.value=d-1,p();break}r.value=d}},p=()=>{var S,k,A;const g=document.querySelector(`#vcvAnchor${r.value}`),d=((S=i.value)==null?void 0:S.clientHeight)||0,w=g.offsetTop,b=((k=i.value)==null?void 0:k.scrollTop)||0,v=w-b;(v>d/2||v<d/2)&&((A=i.value)==null||A.scrollTo({top:w-d/2,behavior:l.value?"instant":"smooth"}))},y=async(g,d)=>{if(l.value=!0,r.value=d,p(),e.useAnchor){l.value=!1;return}await ie(u.value,{top:g.offsetTop-e.topDistance,behavior:"smooth"}),await ce(100),l.value=!1};t.watch(()=>a.value,()=>{f(a.value)});let T;return t.watch(()=>[e.contentContainer,e.isWatch,m.value],async g=>{console.log("val:",g);const[d,w]=g;if(d){if(d.$el?s.value=d.$el:s.value=d,w){T&&T();const{stop:b}=oe(s,async()=>{n.value=await h()},{childList:!0,subtree:!0,characterData:!0});T=b}else T&&T();n.value=await h(),console.log("titles.value:",n.value)}},{immediate:!0}),{titles:n,currentIndex:r,catalogRef:i,handleAnchorClick:y}};function z(){return{type:{type:String,default:"default"},contentContainer:{type:Object,default:()=>document.body},scrollContainer:{type:Object,default:()=>window},selector:{type:Array,default:()=>["h1","h2","h3","h4","h5","h6"]},topDistance:{type:Number,default:0},indent:{type:Number,default:15},useAnchor:{type:Boolean,default:!0},isWatch:{type:Boolean,default:!1},ellipsis:{type:Boolean,default:!0}}}const ue={key:0,class:"vcv-line"},fe=["id","onClick"],de=["href"],pe={key:1},me=t.defineComponent({__name:"CatalogView",props:z(),setup(e){var a,m;const o=e,n=t.useAttrs();console.log("props:",o,n.key);const{titles:r,currentIndex:l,catalogRef:i,handleAnchorClick:u}=ae(o,(m=(a=t.getCurrentInstance())==null?void 0:a.vnode)==null?void 0:m.key);return(s,h)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass(["vcv-wrapper",s.type])},[s.type!=="default"?(t.openBlock(),t.createElementBlock("div",ue)):t.createCommentVNode("",!0),t.createElementVNode("div",{class:"vcv-catalog-content",ref_key:"catalogRef",ref:i},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(r),(f,p)=>(t.openBlock(),t.createElementBlock("div",{key:f.title,id:`vcvAnchor${p}`,onClick:y=>t.unref(u)(f,p),class:t.normalizeClass(["vcv-catalog-item-wrapper",t.unref(l)===p?"active":""])},[t.renderSlot(s.$slots,"default",t.mergeProps({ref_for:!0},{active:t.unref(l)===p,anchor:f}),()=>[t.createElementVNode("div",{class:t.normalizeClass(["vcv-catalog-item",{"text-ellipsis":s.ellipsis}]),style:t.normalizeStyle({paddingLeft:`${15+(f.level-1)*s.indent}px`,paddingRight:"15px"})},[s.useAnchor?(t.openBlock(),t.createElementBlock("a",{key:0,href:`#${f.id}`},t.toDisplayString(f.title),9,de)):(t.openBlock(),t.createElementBlock("span",pe,t.toDisplayString(f.title),1))],6)],!0)],10,fe))),128))],512)],2))}}),he=((e,o)=>{const n=e.__vccOpts||e;for(const[r,l]of o)n[r]=l;return n})(me,[["__scopeId","data-v-cc6f8f2d"]]);L.CatalogView=he,L.catalogViewProps=z,Object.defineProperty(L,Symbol.toStringTag,{value:"Module"})});
